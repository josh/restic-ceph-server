exec restic-ceph-server --socket $WORK/restic.sock &server&
exec wait4socket $WORK/restic.sock

exec curl --silent --unix-socket $WORK/restic.sock --request POST 'http://localhost/?create=true'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --head 'http://localhost/config' --output /dev/null
stdout '404'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --request GET 'http://localhost/config' --output /dev/null
stdout '404'

exec curl --silent --unix-socket $WORK/restic.sock --request POST --data-binary @config-data 'http://localhost/config'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --head 'http://localhost/config' --output /dev/null
stdout '200'

kill server

-- config-data --
{"version":2,"id":"test","chunker_polynomial":"25b468838dcb75ea"}

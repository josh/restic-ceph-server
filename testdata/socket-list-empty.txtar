tail-logs
create-pool

exec restic-rados-server --listen $WORK/restic.sock &server&
wait4socket $WORK/restic.sock

exec curl --silent --unix-socket $WORK/restic.sock --request POST 'http://localhost/?create=true'

exec curl --silent --unix-socket $WORK/restic.sock --request GET http://localhost/data/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET --header 'Accept: application/vnd.x.restic.rest.v2' http://localhost/data/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET http://localhost/locks/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET --header 'Accept: application/vnd.x.restic.rest.v2' http://localhost/locks/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET http://localhost/snapshots/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET --header 'Accept: application/vnd.x.restic.rest.v2' http://localhost/snapshots/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET http://localhost/index/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET --header 'Accept: application/vnd.x.restic.rest.v2' http://localhost/index/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET http://localhost/keys/
stdout '^\[\]$'

exec curl --silent --unix-socket $WORK/restic.sock --request GET --header 'Accept: application/vnd.x.restic.rest.v2' http://localhost/keys/
stdout '^\[\]$'

kill server

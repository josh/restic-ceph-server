tail-server-log

exec restic-ceph-server --listen $WORK/restic.sock &server&
wait4socket $WORK/restic.sock

exec curl --silent --unix-socket $WORK/restic.sock --request POST 'http://localhost/?create=true'

exec curl --silent --include --unix-socket $WORK/restic.sock --request PUT http://localhost/config
stdout 'HTTP/.* 405'
stdout 'Allow: .*POST'

exec curl --silent --include --unix-socket $WORK/restic.sock --request PATCH http://localhost/config
stdout 'HTTP/.* 405'

exec curl --silent --include --unix-socket $WORK/restic.sock --request OPTIONS http://localhost/config
stdout 'HTTP/.* 405'

exec curl --silent --include --unix-socket $WORK/restic.sock --request PUT http://localhost/data/0000000000000000000000000000000000000000000000000000000000000001
stdout 'HTTP/.* 405'
stdout 'Allow: .*POST'

exec curl --silent --include --unix-socket $WORK/restic.sock --request PATCH http://localhost/data/0000000000000000000000000000000000000000000000000000000000000001
stdout 'HTTP/.* 405'

exec curl --silent --include --unix-socket $WORK/restic.sock --request OPTIONS http://localhost/locks/0000000000000000000000000000000000000000000000000000000000000001
stdout 'HTTP/.* 405'

exec curl --silent --include --unix-socket $WORK/restic.sock --request DELETE http://localhost/
stdout 'HTTP/.* 405'
stdout 'Allow: .*POST'

kill server

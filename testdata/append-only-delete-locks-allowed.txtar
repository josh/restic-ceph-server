tail-server-log
create-pool

exec restic-ceph-server --append-only --listen $WORK/restic.sock &server&
wait4socket $WORK/restic.sock

exec curl --silent --unix-socket $WORK/restic.sock --request POST 'http://localhost/?create=true'

exec curl --silent --unix-socket $WORK/restic.sock --request POST --data-binary @lock-data 'http://localhost/locks/5ad8ba0b31f9699fed5f80f6ef585e09429c1c1534a83a655fb2b3934f56ca45'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --request GET 'http://localhost/locks/5ad8ba0b31f9699fed5f80f6ef585e09429c1c1534a83a655fb2b3934f56ca45' --output /dev/null
stdout '200'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --request DELETE 'http://localhost/locks/5ad8ba0b31f9699fed5f80f6ef585e09429c1c1534a83a655fb2b3934f56ca45' --output /dev/null
stdout '200'

exec curl --silent --write-out '%{http_code}' --unix-socket $WORK/restic.sock --request GET 'http://localhost/locks/5ad8ba0b31f9699fed5f80f6ef585e09429c1c1534a83a655fb2b3934f56ca45' --output /dev/null
stdout '404'

kill server

-- lock-data --
{"time":"2025-01-01T00:00:00Z","hostname":"test"}

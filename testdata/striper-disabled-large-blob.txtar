tail-logs
create-pool

exec restic-ceph-server --listen $WORK/restic.sock &server&
wait4socket $WORK/restic.sock

exec curl --silent --unix-socket $WORK/restic.sock --request POST 'http://localhost/?create=true'

bin-file zeros large-blob 40000000

byte-count large-blob
stdout '40000000'

! exec curl --fail --show-error --unix-socket $WORK/restic.sock --request POST --header 'Content-Type: application/octet-stream' --data-binary @large-blob 'http://localhost/data/c0e6623abfbed73c146be81338cff1e8e4c06dd05eb98721163dc79fbbd20562'
stderr '413'

exec rados --pool $CEPH_POOL ls
! stdout 'data/'

kill server
